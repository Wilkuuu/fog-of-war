<ion-menu side="start" menuId="main-menu" [contentId]="contentId" class="custom-menu">
  <ion-content class="menu-content">
    <div class="menu-header">
      <h2 class="menu-title">Fog of War</h2>
      <p class="menu-subtitle">Controls</p>
    </div>

    <div class="menu-sections">
      <!-- Video Section -->
      <div class="menu-section">
        <h3 class="section-title">Video</h3>
        <ion-button class="menu-action-button" expand="block" fill="solid" (click)="selectVideo(); closeMenu()">
          <ion-icon name="videocam-outline" slot="start"></ion-icon>
          <span *ngIf="!videoUrl">Select Video</span>
          <span *ngIf="videoUrl">Change Video</span>
        </ion-button>
      </div>

      <!-- Brush Size Section -->
      <div class="menu-section" *ngIf="videoUrl">
        <h3 class="section-title">Brush Size</h3>
        <div class="brush-size-selector">
          <ion-segment [(ngModel)]="brushSizeStr" (ionChange)="changeBrushSize($event)" class="brush-segment">
            <ion-segment-button value="18" class="brush-option">
              <ion-label>S</ion-label>
            </ion-segment-button>
            <ion-segment-button value="60" class="brush-option">
              <ion-label>M</ion-label>
            </ion-segment-button>
            <ion-segment-button value="192" class="brush-option">
              <ion-label>L</ion-label>
            </ion-segment-button>
          </ion-segment>
        </div>
      </div>

      <!-- Actions Section -->
      <div class="menu-section" *ngIf="videoUrl">
        <h3 class="section-title">Actions</h3>
        <div class="action-buttons">
          <ion-button class="action-button primary" expand="block" fill="solid" (click)="removeAllFog(); closeMenu()">
            <ion-icon name="eye-outline" slot="start"></ion-icon>
            Reveal All
          </ion-button>
          <ion-button class="action-button" expand="block" fill="outline" (click)="undo(); closeMenu()">
            <ion-icon name="arrow-undo-outline" slot="start"></ion-icon>
            Undo
          </ion-button>
          <ion-button class="action-button" expand="block" fill="outline" (click)="resetFog(); closeMenu()">
            <ion-icon name="refresh-outline" slot="start"></ion-icon>
            Reset Fog
          </ion-button>
        </div>
      </div>
    </div>
  </ion-content>
</ion-menu>

<div class="ion-page" [id]="contentId" style="height: 100vh; display: flex; flex-direction: column;">
  <ion-content [fullscreen]="true" class="video-content" style="flex: 1; min-height: 0;">
    <div *ngIf="!videoUrl" class="empty-state">
      <div class="empty-state-content">
        <h1 class="empty-state-title">Fog of War</h1>
        <p class="empty-state-description">Select a video to begin revealing hidden content</p>
        <ion-button class="select-video-button" expand="block" (click)="selectVideo()">
          <ion-icon name="videocam-outline" slot="start"></ion-icon>
          Select Video
        </ion-button>
      </div>
    </div>

    <div *ngIf="videoUrl" class="video-container" (touchstart)="onContainerTouch($event)" (touchend)="onContainerTouchEnd($event)">
      <video 
        #videoElement 
        [src]="videoUrl" 
        autoplay 
        muted 
        loop
        playsinline
        style="display: none;">
      </video>
      
      <canvas 
        #canvasElement 
        class="fog-canvas"
        (touchstart)="onCanvasTouch($event)"
        (touchmove)="onCanvasTouchMove($event)"
        (touchend)="onCanvasTouchEnd($event)"
        (mousedown)="onCanvasMouseDown($event)"
        (mousemove)="onCanvasMouseMove($event)"
        (mouseup)="onCanvasMouseUp()"
        (mouseleave)="onCanvasMouseUp()">
      </canvas>
    </div>
    
    <!-- Floating hamburger menu button - almost invisible, fallback option -->
    <button class="menu-button" (click)="openMenu()" type="button" title="Menu (or use two-finger tap)">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M3 12H21M3 6H21M3 18H21" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>
    </button>
  </ion-content>
</div>

